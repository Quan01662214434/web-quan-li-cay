<!DOCTYPE html>
<html>
<head>
  <title>Qu·∫£n l√Ω c√¢y</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="layout">
  <aside class="sidebar">
    <h2>üå± Thanh Huy·ªÅn</h2>
    <a href="/">‚¨Ö Quay l·∫°i</a>
  </aside>

  <main class="main">
    <h1>Qu·∫£n l√Ω c√¢y</h1>

    <div class="card">
      <h3>C·∫≠p nh·∫≠t t√¨nh tr·∫°ng</h3>
      <input id="health" placeholder="T√¨nh tr·∫°ng">
      <textarea id="notes" placeholder="Ghi ch√∫"></textarea>
      <button class="btn" onclick="updateHealth()">C·∫≠p nh·∫≠t</button>
    </div>

    <div class="card">
      <h3>·∫¢nh c√¢y</h3>
      <input type="file" id="image">
      <button class="btn outline" onclick="uploadImage()">Upload ·∫£nh</button>
    </div>

    <div class="card">
      <h3>G√°n nh√¢n vi√™n</h3>
      <select id="staff"></select>
      <button class="btn" onclick="assignStaff()">G√°n</button>
    </div>

    <div class="card">
      <h3>B·ªánh</h3>
      <input id="disease" placeholder="T√™n b·ªánh">
      <input id="status" placeholder="Tr·∫°ng th√°i">
      <button class="btn outline" onclick="addDisease()">Th√™m</button>
    </div>
  </main>
</div>

<script>
const id = new URLSearchParams(location.search).get("id");

fetch("/api/users")
  .then(r => r.json())
  .then(d => staff.innerHTML =
    d.map(s => `<option value="${s._id}">${s.name}</option>`).join("")
  );

function updateHealth() {
  fetch(`/api/trees/${id}/health`, {
    method:"PUT",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      currentHealth: health.value,
      notes: notes.value
    })
  });
}

function uploadImage() {
  const fd = new FormData();
  fd.append("image", image.files[0]);
  fetch(`/api/trees/${id}/image`, { method:"PUT", body: fd });
}

function assignStaff() {
  fetch(`/api/trees/${id}/assign`, {
    method:"PUT",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ staffId: staff.value })
  });
}

function addDisease() {
  fetch(`/api/trees/${id}/diseases`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      name: disease.value,
      status: status.value
    })
  });
}
</script>

</body>
</html>
