<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thanh Huyá»n Farm ğŸŒ¿</title>
  <style>
    :root {
      --main-green: #3fa34d;
      --light-green: #dff6e1;
      --dark-green: #2a7a35;
      --white: #fff;
    }

    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, var(--light-green), var(--white));
      color: var(--dark-green);
      margin: 0;
      padding: 0;
    }

    header {
      background: var(--main-green);
      color: white;
      text-align: center;
      padding: 15px 0;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    }

    header h1 {
      margin: 0;
      font-size: 1.8rem;
      letter-spacing: 0.5px;
    }

    .container {
      max-width: 420px;
      margin: 60px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .container h2 {
      color: var(--dark-green);
      margin-bottom: 20px;
    }

    input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: var(--main-green);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: var(--dark-green);
    }

    .hidden {
      display: none;
    }

    #logout-btn {
      background-color: #b22222;
      margin-top: 15px;
    }

    #dashboard {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    footer {
      margin-top: 50px;
      text-align: center;
      font-size: 0.9rem;
      color: #666;
      padding: 20px;
    }

    @media (max-width: 600px) {
      .container, #dashboard {
        margin: 20px;
        padding: 20px;
      }
      header h1 {
        font-size: 1.4rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸŒ¿ Thanh Huyá»n Farm â€“ Quáº£n lÃ½ vÆ°á»n sáº§u riÃªng</h1>
  </header>

  <main>
    <!-- ÄÄƒng nháº­p -->
    <section id="login-section" class="container">
      <h2>ÄÄƒng nháº­p há»‡ thá»‘ng ğŸŒ±</h2>
      <form id="login-form">
        <input type="text" id="username" placeholder="TÃªn Ä‘Äƒng nháº­p" required />
        <input type="password" id="password" placeholder="Máº­t kháº©u" required />
        <button type="submit">ÄÄƒng nháº­p</button>
      </form>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" class="hidden">
      <h2>ChÃ o má»«ng Ä‘áº¿n vá»›i há»‡ thá»‘ng quáº£n lÃ½ ğŸŒ³</h2>
      <p id="user-role-text"></p>
      <button id="logout-btn">ÄÄƒng xuáº¥t</button>
      <div id="tree-list"></div>
    </section>
  </main>

  <footer>
    Thanh Huyá»n Farm | VÆ°á»n sáº§u riÃªng há»¯u cÆ¡ â€“ Äá»©c Trá»ng, LÃ¢m Äá»“ng ğŸŒ¿
  </footer>

  <script>
    // ====== Cáº¥u hÃ¬nh API backend ======
    const API_BASE = "http://localhost:4000"; // <== Äá»‹a chá»‰ backend (khi cháº¡y local)

    let token = null;
    let currentUser = null;

    // ====== ÄÄƒng nháº­p ======
    document.getElementById("login-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      try {
        const res = await fetch(`${API_BASE}/auth/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
        });

        let data;
        try {
          data = await res.json();
        } catch (err) {
          alert("âŒ Server tráº£ vá» dá»¯ liá»‡u khÃ´ng há»£p lá»‡ (khÃ´ng pháº£i JSON).");
          return;
        }

        if (!res.ok) {
          alert(data.error || "âŒ ÄÄƒng nháº­p tháº¥t báº¡i (server bÃ¡o lá»—i).");
          return;
        }

        if (data.token) {
          token = data.token;
          currentUser = data.user;
          document.getElementById("login-section").classList.add("hidden");
          document.getElementById("dashboard").classList.remove("hidden");
          document.getElementById("user-role-text").innerText =
            `ğŸŒ¿ Xin chÃ o ${currentUser.username} â€“ Vai trÃ²: ${currentUser.role}`;
          loadTrees();
        } else {
          alert(data.error || "âŒ KhÃ´ng nháº­n Ä‘Æ°á»£c token tá»« server.");
        }
      } catch (err) {
        console.error(err);
        alert("âš ï¸ KhÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c tá»›i server.\nHÃ£y cháº¯c cháº¯n ráº±ng báº¡n Ä‘ang má»Ÿ http://localhost:4000 vÃ  Ä‘Ã£ cháº¡y npm start.");
      }
    });

    // ====== ÄÄƒng xuáº¥t ======
    document.getElementById("logout-btn").addEventListener("click", () => {
      token = null;
      currentUser = null;
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("login-section").classList.remove("hidden");
      document.getElementById("logout-btn").classList.add("hidden");
    });

    // ====== Táº£i danh sÃ¡ch cÃ¢y ======
    async function loadTrees() {
      try {
        const res = await fetch(`${API_BASE}/api/trees`, {
          headers: { Authorization: `Bearer ${token}` },
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "KhÃ´ng thá»ƒ táº£i danh sÃ¡ch cÃ¢y");

        const container = document.getElementById("tree-list");
        container.innerHTML = "";
        data.forEach((t) => {
          const div = document.createElement("div");
          div.style.border = "1px solid #ccc";
          div.style.padding = "10px";
          div.style.margin = "10px 0";
          div.style.borderRadius = "8px";
          div.innerHTML = `<b>${t.name}</b> (${t.species}) - ${t.location}`;
          container.appendChild(div);
        });
      } catch (err) {
        console.error(err);
        alert("âŒ KhÃ´ng thá»ƒ táº£i danh sÃ¡ch cÃ¢y.");
      }
    }
  </script>
</body>
</html>
