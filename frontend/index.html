<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thanh Huy·ªÅn Farm üåø</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <div class="logo-circle">TH</div>
        <div class="brand-text">
          <div class="brand-name">Thanh Huy·ªÅn Farm</div>
          <div class="brand-sub">Qu·∫£n l√Ω v∆∞·ªùn s·∫ßu ri√™ng</div>
        </div>
      </div>
      <div class="header-actions">
        <button
          id="display-config-btn"
          class="btn-secondary small hidden"
          type="button"
        >
          Hi·ªÉn th·ªã QR
        </button>
        <button
          id="logout-btn"
          class="btn-secondary small hidden"
          type="button"
        >
          ƒêƒÉng xu·∫•t
        </button>
      </div>
    </header>

    <main>
      <!-- LOGIN -->
      <section id="login-section" class="card card-center">
        <h2>ƒêƒÉng nh·∫≠p</h2>
        <p class="sub">D√†nh cho ch·ªß v∆∞·ªùn / nh√¢n vi√™n</p>
        <form id="login-form">
          <input
            type="text"
            id="username"
            placeholder="T√™n ƒëƒÉng nh·∫≠p"
            required
          />
          <input
            type="password"
            id="password"
            placeholder="M·∫≠t kh·∫©u"
            required
          />
          <button type="submit" class="btn-primary">ƒêƒÉng nh·∫≠p</button>
        </form>
        <p class="hint">
          T√†i kho·∫£n m·∫∑c ƒë·ªãnh: <b>thanhhuyen</b> / <b>12345</b><br />
          (Tr∆∞·ªõc ƒë√≥ g·ªçi <code>https://api.thefram.site/auth/seed-owner</code> 1
          l·∫ßn ƒë·ªÉ t·∫°o/reset)
        </p>
      </section>

      <!-- DASHBOARD -->
      <section id="dashboard" class="hidden">
        <section class="card">
          <h2>Ch√†o m·ª´ng üåø</h2>
          <p id="user-info"></p>
        </section>

        <section class="card">
          <h3>Th√™m c√¢y m·ªõi</h3>
          <form id="create-tree-form">
            <input
              type="text"
              id="tree-name"
              placeholder="T√™n c√¢y (VD: SR-01)"
              required
            />
            <input
              type="text"
              id="tree-species"
              placeholder="Gi·ªëng (VD: Ri6, Musang King)"
              required
            />

            <!-- KHU V·ª∞C -->
            <div class="field-group">
              <label for="tree-area" class="field-label">Khu v·ª±c</label>
              <div class="field-inline">
                <select id="tree-area"></select>
                <button
                  type="button"
                  class="btn-secondary small"
                  id="add-area-btn"
                >
                  + Th√™m khu
                </button>
              </div>
            </div>

            <input
              type="text"
              id="tree-location"
              placeholder="V·ªã tr√≠ chi ti·∫øt (VD: H√†ng 2, C√¢y 5)"
              required
            />
            <input type="date" id="tree-date" required />
            <input
              type="text"
              id="tree-image"
              placeholder="URL ·∫£nh c√¢y (tu·ª≥ ch·ªçn)"
            />
            <button type="submit" class="btn-primary">
              L∆∞u c√¢y & t·∫°o QR
            </button>
          </form>
        </section>

        <section class="card">
          <h3>Danh s√°ch c√¢y</h3>
          <div id="tree-list" class="tree-list"></div>
        </section>
      </section>
    </main>

    <!-- MODAL QR -->
    <div id="qr-modal" class="modal hidden">
      <div class="modal-content">
        <h3>QR c√¢y</h3>
        <img id="qr-image" alt="QR" />
        <p class="qr-note">
          Qu√©t QR n√†y ƒë·ªÉ xem th√¥ng tin c√¢y (public) tr√™n ƒëi·ªán tho·∫°i.
        </p>
        <button class="btn-secondary small" onclick="closeModal('qr-modal')">
          ƒê√≥ng
        </button>
      </div>
    </div>

    <!-- MODAL YIELD -->
    <div id="yield-modal" class="modal hidden">
      <div class="modal-content">
        <h3>NƒÉng su·∫•t c√¢y theo nƒÉm</h3>
        <canvas id="yield-chart"></canvas>
        <form id="yield-form">
          <input type="number" id="yield-year" placeholder="NƒÉm" required />
          <input
            type="number"
            id="yield-quantity"
            placeholder="S·∫£n l∆∞·ª£ng (kg)"
            required
          />
          <button type="submit" class="btn-primary small">L∆∞u nƒÉng su·∫•t</button>
        </form>
        <button class="btn-secondary small" onclick="closeModal('yield-modal')">
          ƒê√≥ng
        </button>
      </div>
    </div>

    <!-- MODAL B·ªÜNH -->
    <div id="disease-modal" class="modal hidden">
      <div class="modal-content">
        <h3>Danh s√°ch b·ªánh üå±</h3>
        <div id="disease-list" class="disease-list"></div>

        <div class="add-disease">
          <input
            type="text"
            id="new-disease-name"
            placeholder="Nh·∫≠p t√™n b·ªánh m·ªõi (VD: Th·ªëi r·ªÖ)"
          />
          <button type="button" class="btn-secondary small" id="add-disease-btn">
            + Th√™m b·ªánh
          </button>
        </div>

        <button class="btn-primary small" id="save-disease-btn">
          L∆∞u b·ªánh cho c√¢y
        </button>
        <button
          class="btn-secondary small"
          onclick="closeModal('disease-modal')"
        >
          ƒê√≥ng
        </button>
      </div>
    </div>

    <!-- MODAL C·∫§U H√åNH HI·ªÇN TH·ªä QR -->
    <div id="display-config-modal" class="modal hidden">
      <div class="modal-content">
        <h3>Tu·ª≥ ch·ªçn hi·ªÉn th·ªã QR</h3>
        <p class="sub">
          B·∫≠t/t·∫Øt c√°c tr∆∞·ªùng s·∫Ω xu·∫•t hi·ªán khi kh√°ch qu√©t QR c√¢y.
        </p>
        <div class="disease-list">
          <div class="disease-item">
            <input type="checkbox" id="cfg-name" />
            <label for="cfg-name">T√™n c√¢y</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-species" />
            <label for="cfg-species">Gi·ªëng</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-area" />
            <label for="cfg-area">Khu v·ª±c</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-location" />
            <label for="cfg-location">V·ªã tr√≠</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-plantDate" />
            <label for="cfg-plantDate">Ng√†y tr·ªìng</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-image" />
            <label for="cfg-image">·∫¢nh c√¢y</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-health" />
            <label for="cfg-health">T√¨nh tr·∫°ng</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-notes" />
            <label for="cfg-notes">Ghi ch√∫</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-diseases" />
            <label for="cfg-diseases">B·ªánh</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-yield" />
            <label for="cfg-yield">NƒÉng su·∫•t</label>
          </div>
          <div class="disease-item">
            <input type="checkbox" id="cfg-ownerName" />
            <label for="cfg-ownerName">T√™n ch·ªß v∆∞·ªùn</label>
          </div>
        </div>

        <button class="btn-primary small" id="save-display-config-btn">
          L∆∞u c·∫•u h√¨nh
        </button>
        <button
          class="btn-secondary small"
          onclick="closeModal('display-config-modal')"
        >
          ƒê√≥ng
        </button>
      </div>
    </div>

    <footer>
      üåø Thanh Huy·ªÅn Farm ‚Äì V∆∞·ªùn s·∫ßu ri√™ng h·ªØu c∆°, ƒê·ª©c Tr·ªçng ‚Äì L√¢m ƒê·ªìng
    </footer>

    <script>
      // üîß BACKEND Render:
      const API_BASE = "https://api.thefram.site";

      let token = null;
      let currentUser = null;
      let lastTrees = [];
      let currentYieldTreeId = null;
      let chartInstance = null;
      let diseaseMaster = [];
      let currentDiseaseTreeId = null;
      let displayConfig = null;

      // =============== LOGIN ===============
      document
        .getElementById("login-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const username = document.getElementById("username").value.trim();
          const password = document.getElementById("password").value.trim();

          try {
            const res = await fetch(`${API_BASE}/auth/login`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password }),
            });
            const data = await res.json();
            if (!res.ok) {
              alert(data.error || "ƒêƒÉng nh·∫≠p th·∫•t b·∫°i");
              return;
            }
            token = data.token;
            currentUser = data.user;

            document.getElementById("login-section").classList.add("hidden");
            document.getElementById("dashboard").classList.remove("hidden");
            document
              .getElementById("logout-btn")
              .classList.remove("hidden");
            document
              .getElementById("display-config-btn")
              .classList.remove("hidden");

            document.getElementById(
              "user-info"
            ).innerText = `Xin ch√†o ${currentUser.username} ‚Äì Vai tr√≤: ${
              currentUser.role
            } ‚Äì V∆∞·ªùn: ${currentUser.farmName || "Thanh Huy·ªÅn Farm"}`;

            await loadDisplayConfig();
            loadTrees();
          } catch (err) {
            console.error(err);
            alert("Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c server (API).");
          }
        });

      document
        .getElementById("logout-btn")
        .addEventListener("click", () => location.reload());

      // =============== KHU V·ª∞C ===============
      function loadAreas() {
        const select = document.getElementById("tree-area");
        if (!select) return;

        let areas = [];
        try {
          areas = JSON.parse(localStorage.getItem("farmAreas") || "[]");
        } catch {
          areas = [];
        }

        if (!areas.length) {
          areas = ["Khu A", "Khu B", "Khu C"];
          localStorage.setItem("farmAreas", JSON.stringify(areas));
        }

        select.innerHTML = "";
        areas.forEach((a) => {
          const opt = document.createElement("option");
          opt.value = a;
          opt.textContent = a;
          select.appendChild(opt);
        });
      }

      function addNewArea() {
        let areas = [];
        try {
          areas = JSON.parse(localStorage.getItem("farmAreas") || "[]");
        } catch {
          areas = [];
        }

        const name = prompt("Nh·∫≠p t√™n khu v·ª±c m·ªõi (VD: Khu B·ªù Su·ªëi):");
        if (!name) return;
        const trimmed = name.trim();
        if (!trimmed) return;

        if (!areas.includes(trimmed)) {
          areas.push(trimmed);
          localStorage.setItem("farmAreas", JSON.stringify(areas));
        }

        loadAreas();
        const select = document.getElementById("tree-area");
        if (select) select.value = trimmed;
      }

      // =============== T·∫†O C√ÇY ===============
      document
        .getElementById("create-tree-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const name = document.getElementById("tree-name").value.trim();
          const species = document
            .getElementById("tree-species")
            .value.trim();
          const area = document.getElementById("tree-area").value;
          const location = document
            .getElementById("tree-location")
            .value.trim();
          const plantDate = document.getElementById("tree-date").value;
          const imageURL = document.getElementById("tree-image").value.trim();

          try {
            const res = await fetch(`${API_BASE}/api/trees`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({
                name,
                species,
                area,
                location,
                plantDate,
                imageURL,
              }),
            });
            const data = await res.json();
            if (!res.ok) {
              alert(data.error || "Kh√¥ng th·ªÉ t·∫°o c√¢y");
              return;
            }
            alert("‚úÖ ƒê√£ t·∫°o c√¢y & QR");
            e.target.reset();
            loadTrees();
          } catch (err) {
            console.error(err);
            alert("L·ªói khi t·∫°o c√¢y");
          }
        });

      // =============== DANH S√ÅCH C√ÇY ===============
      async function loadTrees() {
        try {
          const res = await fetch(`${API_BASE}/api/trees`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          const trees = await res.json();
          if (!res.ok) {
            alert(trees.error || "Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¢y");
            return;
          }
          lastTrees = trees;

          const container = document.getElementById("tree-list");
          container.innerHTML = "";
          if (!trees.length) {
            container.innerHTML = "<p>Ch∆∞a c√≥ c√¢y n√†o. H√£y th√™m c√¢y m·ªõi.</p>";
            return;
          }
          trees.forEach((t) => {
            const card = document.createElement("div");
            card.className = "tree-card";
            const diseasesText = (t.diseases || []).join(", ");
            card.innerHTML = `
              <div class="tree-main">
                <div class="tree-title">#${t.numericId} ‚Äì ${t.name}</div>
                <div class="tree-sub">
                  ${t.species} ‚Ä¢ Khu: ${t.area || "Ch∆∞a r√µ"} ‚Ä¢ V·ªã tr√≠: ${
              t.location
            }
                </div>
                <div class="tree-health">T√¨nh tr·∫°ng: <b>${
                  t.currentHealth
                }</b></div>
                ${
                  diseasesText
                    ? `<div class="tree-disease">B·ªánh: ${diseasesText}</div>`
                    : ""
                }
              </div>
              <div class="tree-actions">
                <button class="btn-secondary small" onclick="openQrModal('${
                  t.qrCode
                }')">QR</button>
                <button class="btn-secondary small" onclick="openYield('${
                  t._id
                }')">NƒÉng su·∫•t</button>
                <button class="btn-secondary small" onclick="editHealth('${
                  t._id
                }','${(t.currentHealth || "")
              .replace(/'/g, "\\'")
              .replace(/"/g, "&quot;")}','${(t.notes || "")
              .replace(/'/g, "\\'")
              .replace(/"/g, "&quot;")}')">T√¨nh tr·∫°ng</button>
                <button class="btn-secondary small" onclick="openDiseaseModal('${
                  t._id
                }')">B·ªánh</button>
              </div>
            `;
            container.appendChild(card);
          });
        } catch (err) {
          console.error(err);
          alert("L·ªói khi t·∫£i danh s√°ch c√¢y");
        }
      }

      // =============== QR MODAL ===============
      function openQrModal(dataUrl) {
        document.getElementById("qr-image").src = dataUrl;
        document.getElementById("qr-modal").classList.remove("hidden");
      }

      function closeModal(id) {
        document.getElementById(id).classList.add("hidden");
      }

      // =============== T√åNH TR·∫†NG / GHI CH√ö ===============
      async function editHealth(id, currentHealth, notes) {
        const health = prompt(
          "Nh·∫≠p t√¨nh tr·∫°ng (VD: B√¨nh th∆∞·ªùng, C·∫ßn chƒÉm s√≥c, B·ªã s√¢u b·ªánh):",
          currentHealth || "B√¨nh th∆∞·ªùng"
        );
        if (health === null) return;
        const note = prompt("Ghi ch√∫ th√™m (c√≥ th·ªÉ b·ªè tr·ªëng):", notes || "");
        try {
          const res = await fetch(`${API_BASE}/api/trees/${id}/health`, {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({
              currentHealth: health,
              notes: note,
            }),
          });
          const data = await res.json();
          if (!res.ok) {
            alert(data.error || "Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t");
            return;
          }
          loadTrees();
        } catch (err) {
          console.error(err);
          alert("L·ªói khi c·∫≠p nh·∫≠t");
        }
      }

      // =============== B·ªÜNH ===============
      function loadDiseaseMaster() {
        try {
          diseaseMaster = JSON.parse(
            localStorage.getItem("diseaseMaster") || "[]"
          );
        } catch {
          diseaseMaster = [];
        }
        if (!diseaseMaster.length) {
          diseaseMaster = [
            "Th·ªëi r·ªÖ",
            "S√¢u ƒë·ª•c th√¢n",
            "N·∫•m Phytophthora",
            "Th√°n th∆∞",
          ];
          localStorage.setItem(
            "diseaseMaster",
            JSON.stringify(diseaseMaster)
          );
        }
      }

      function renderDiseaseListForTree(tree) {
        const container = document.getElementById("disease-list");
        container.innerHTML = "";
        const current = tree.diseases || [];

        diseaseMaster.forEach((name) => {
          const wrap = document.createElement("div");
          wrap.className = "disease-item";
          const id = `dis-${name.replace(/\s+/g, "-")}`;

          wrap.innerHTML = `
            <input type="checkbox" id="${id}" value="${name}" ${
            current.includes(name) ? "checked" : ""
          } />
            <label for="${id}">${name}</label>
          `;
          container.appendChild(wrap);
        });
      }

      function openDiseaseModal(treeId) {
        currentDiseaseTreeId = treeId;
        loadDiseaseMaster();

        const tree = lastTrees.find((t) => t._id === treeId);
        if (!tree) {
          alert("Kh√¥ng t√¨m th·∫•y c√¢y ƒë·ªÉ ch·ªânh b·ªánh");
          return;
        }

        renderDiseaseListForTree(tree);
        document.getElementById("disease-modal").classList.remove("hidden");
      }

      function addNewDisease() {
        loadDiseaseMaster();
        const input = document.getElementById("new-disease-name");
        const name = (input.value || "").trim();
        if (!name) return;

        if (!diseaseMaster.includes(name)) {
          diseaseMaster.push(name);
          localStorage.setItem(
            "diseaseMaster",
            JSON.stringify(diseaseMaster)
          );
        }
        input.value = "";
        if (currentDiseaseTreeId) {
          const tree = lastTrees.find(
            (t) => t._id === currentDiseaseTreeId
          );
          if (tree) renderDiseaseListForTree(tree);
        }
      }

      async function saveDiseaseForTree() {
        if (!currentDiseaseTreeId) return;
        const checkboxes = document.querySelectorAll(
          "#disease-list input[type='checkbox']:checked"
        );
        const diseases = Array.from(checkboxes).map((c) => c.value);

        try {
          const res = await fetch(
            `${API_BASE}/api/trees/${currentDiseaseTreeId}/diseases`,
            {
              method: "PATCH",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ diseases }),
            }
          );
          const data = await res.json();
          if (!res.ok) {
            alert(data.error || "Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t b·ªánh");
            return;
          }
          alert("‚úÖ ƒê√£ l∆∞u danh s√°ch b·ªánh cho c√¢y");
          closeModal("disease-modal");
          loadTrees();
        } catch (err) {
          console.error(err);
          alert("L·ªói khi l∆∞u b·ªánh");
        }
      }

      // =============== NƒÇNG SU·∫§T ===============
      async function openYield(id) {
        currentYieldTreeId = id;
        document.getElementById("yield-modal").classList.remove("hidden");

        try {
          const res = await fetch(`${API_BASE}/api/trees`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          const trees = await res.json();
          const tree = trees.find((t) => t._id === id);
          const ctx = document
            .getElementById("yield-chart")
            .getContext("2d");
          if (chartInstance) chartInstance.destroy();
          const labels = (tree.yieldHistory || []).map((y) => y.year);
          const data = (tree.yieldHistory || []).map((y) => y.quantity);
          chartInstance = new Chart(ctx, {
            type: "bar",
            data: {
              labels,
              datasets: [
                {
                  label: "NƒÉng su·∫•t (kg)",
                  data,
                  backgroundColor: "#3fa34d",
                },
              ],
            },
            options: {
              responsive: true,
              scales: { y: { beginAtZero: true } },
            },
          });
        } catch (err) {
          console.error(err);
          alert("L·ªói khi t·∫£i nƒÉng su·∫•t");
        }
      }

      document
        .getElementById("yield-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          if (!currentYieldTreeId) return;
          const year = document.getElementById("yield-year").value;
          const quantity = document.getElementById("yield-quantity").value;

          try {
            const res = await fetch(
              `${API_BASE}/api/trees/${currentYieldTreeId}/yield`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify({ year, quantity }),
              }
            );
            const data = await res.json();
            if (!res.ok) {
              alert(data.error || "Kh√¥ng th·ªÉ l∆∞u nƒÉng su·∫•t");
              return;
            }
            alert("‚úÖ ƒê√£ l∆∞u nƒÉng su·∫•t");
            closeModal("yield-modal");
            e.target.reset();
            loadTrees();
          } catch (err) {
            console.error(err);
            alert("L·ªói khi l∆∞u nƒÉng su·∫•t");
          }
        });

      // =============== C·∫§U H√åNH HI·ªÇN TH·ªä QR ===============
      const DISPLAY_FIELDS = [
        { key: "showName", checkboxId: "cfg-name" },
        { key: "showSpecies", checkboxId: "cfg-species" },
        { key: "showArea", checkboxId: "cfg-area" },
        { key: "showLocation", checkboxId: "cfg-location" },
        { key: "showPlantDate", checkboxId: "cfg-plantDate" },
        { key: "showImage", checkboxId: "cfg-image" },
        { key: "showCurrentHealth", checkboxId: "cfg-health" },
        { key: "showNotes", checkboxId: "cfg-notes" },
        { key: "showDiseases", checkboxId: "cfg-diseases" },
        { key: "showYield", checkboxId: "cfg-yield" },
        { key: "showOwnerName", checkboxId: "cfg-ownerName" },
      ];

      async function loadDisplayConfig() {
        try {
          const res = await fetch(`${API_BASE}/api/display-config`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          const cfg = await res.json();
          if (!res.ok) {
            console.error(cfg);
            return;
          }
          displayConfig = cfg;
        } catch (err) {
          console.error("L·ªói load display config:", err);
        }
      }

      function applyDisplayConfigToModal() {
        if (!displayConfig) return;
        DISPLAY_FIELDS.forEach(({ key, checkboxId }) => {
          const cb = document.getElementById(checkboxId);
          if (!cb) return;
          cb.checked = displayConfig[key] !== false;
        });
      }

      function openDisplayConfigModal() {
        if (!displayConfig) {
          displayConfig = {};
        }
        applyDisplayConfigToModal();
        document
          .getElementById("display-config-modal")
          .classList.remove("hidden");
      }

      async function saveDisplayConfig() {
        const payload = {};
        DISPLAY_FIELDS.forEach(({ key, checkboxId }) => {
          const cb = document.getElementById(checkboxId);
          if (!cb) return;
          payload[key] = cb.checked;
        });

        try {
          const res = await fetch(`${API_BASE}/api/display-config`, {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(payload),
          });
          const data = await res.json();
          if (!res.ok) {
            alert(data.error || "Kh√¥ng th·ªÉ l∆∞u c·∫•u h√¨nh");
            return;
          }
          displayConfig = data;
          alert("‚úÖ ƒê√£ l∆∞u c·∫•u h√¨nh hi·ªÉn th·ªã QR");
          closeModal("display-config-modal");
        } catch (err) {
          console.error(err);
          alert("L·ªói khi l∆∞u c·∫•u h√¨nh");
        }
      }

      // =============== DOM READY ===============
      document.addEventListener("DOMContentLoaded", () => {
        loadAreas();
        loadDiseaseMaster();

        const addAreaBtn = document.getElementById("add-area-btn");
        if (addAreaBtn) addAreaBtn.addEventListener("click", addNewArea);

        const addDisBtn = document.getElementById("add-disease-btn");
        const saveDisBtn = document.getElementById("save-disease-btn");
        if (addDisBtn) addDisBtn.addEventListener("click", addNewDisease);
        if (saveDisBtn) saveDisBtn.addEventListener("click", saveDiseaseForTree);

        const displayBtn = document.getElementById("display-config-btn");
        const saveDisplayBtn = document.getElementById(
          "save-display-config-btn"
        );
        if (displayBtn)
          displayBtn.addEventListener("click", openDisplayConfigModal);
        if (saveDisplayBtn)
          saveDisplayBtn.addEventListener("click", saveDisplayConfig);
      });

      // GLOBAL
      window.openQrModal = openQrModal;
      window.openYield = openYield;
      window.closeModal = closeModal;
      window.editHealth = editHealth;
      window.openDiseaseModal = openDiseaseModal;
    </script>
  </body>
</html>
